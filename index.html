<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="utf-8">
    <title>AR Ports Istanbul</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://ar-js-org.github.io/AR.js/aframe/build/aframe-ar.js"></script>    
</head>

<body style="margin : 0px; overflow: hidden;">
    <a-scene id="scene" vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;">

        <!-- Kadıköy İskelesi -->
        <a-box id="Kadikoy" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 40.9901; longitude: 29.0230;">
        </a-box>
        <a-text id="Kadikoy-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 40.9901; longitude: 29.0230;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Eminönü İskelesi -->
        <a-box id="Eminonu" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0177; longitude: 28.9710;">
        </a-box>
        <a-text id="Eminonu-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0177; longitude: 28.9710;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Beşiktaş İskelesi -->
        <a-box id="Besiktas" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0410; longitude: 29.0092;">
        </a-box>
        <a-text id="Besiktas-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0410; longitude: 29.0092;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Karaköy İskelesi -->
        <a-box id="Karakoy" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0201; longitude: 28.9735;">
        </a-box>
        <a-text id="Karakoy-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0201; longitude: 28.9735;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Üsküdar İskelesi -->
        <a-box id="Uskudar" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0260; longitude: 29.0156;">
        </a-box>
        <a-text id="Uskudar-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0260; longitude: 29.0156;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Kabataş İskelesi -->
        <a-box id="Kabatas" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0386; longitude: 28.9948;">
        </a-box>
        <a-text id="Kabatas-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0386; longitude: 28.9948;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Haliç Hattı (Eyüp İskelesi) -->
        <a-box id="Eyup" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0483; longitude: 28.9331;">
        </a-box>
        <a-text id="Eyup-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0483; longitude: 28.9331;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Yenikapı İDO İskelesi -->
        <a-box id="Yenikapi" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 40.9986; longitude: 28.9530;">
        </a-box>
        <a-text id="Yenikapi-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 40.9986; longitude: 28.9530;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Harem İskelesi -->
        <a-box id="Harem" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0055; longitude: 29.0180;">
        </a-box>
        <a-text id="Harem-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0055; longitude: 29.0180;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Kuzguncuk İskelesi -->
        <a-box id="Kuzguncuk" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0424; longitude: 29.0266;">
        </a-box>
        <a-text id="Kuzguncuk-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0424; longitude: 29.0266;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Ortaköy İskelesi -->
        <a-box id="Ortakoy" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0473; longitude: 29.0277;">
        </a-box>
        <a-text id="Ortakoy-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0473; longitude: 29.0277;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Bebek İskelesi -->
        <a-box id="Bebek" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0756; longitude: 29.0461;">
        </a-box>
        <a-text id="Bebek-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0756; longitude: 29.0461;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Bostancı İskelesi -->
        <a-box id="Bostanci" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 40.9592; longitude: 29.0947;">
        </a-box>
        <a-text id="Bostanci-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 40.9592; longitude: 29.0947;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Sirkeci İskelesi -->
        <a-box id="Sirkeci" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 41.0145; longitude: 28.9783;">
        </a-box>
        <a-text id="Sirkeci-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 41.0145; longitude: 28.9783;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Bakırköy İskelesi -->
        <a-box id="Bakirkoy" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 40.9735; longitude: 28.8754;">
        </a-box>
        <a-text id="Bakirkoy-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 40.9735; longitude: 28.8754;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <!-- Adalar (Büyükada) İskelesi -->
        <a-box id="Buyukada" color="#FF6347" scale="5 5 5"
            look-at="[gps-camera]"
            gps-entity-place="latitude: 40.8684; longitude: 29.1224;">
        </a-box>
        <a-text id="Buyukada-distance" look-at="[gps-camera]" color="white" scale="5 5 5"
            gps-entity-place="latitude: 40.8684; longitude: 29.1224;" position="0 -19 1"
            animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"></a-text>

        <a-camera gps-camera rotation-reader></a-camera>

    </a-scene>
    <script>
        window.addEventListener('load', function () {
            var cameraEl = document.querySelector('a-camera');
            var initialScale = 1;
            var initialDistance = null;

            function getDistance(touches) {
                var dx = touches[0].pageX - touches[1].pageX;
                var dy = touches[0].pageY - touches[1].pageY;
                return Math.sqrt(dx * dx + dy * dy);
            }

            function onPinchStart(event) {
                if (event.touches.length === 2) {
                    initialDistance = getDistance(event.touches);
                    document.addEventListener('touchmove', onPinchMove);
                    document.addEventListener('touchend', onPinchEnd);
                }
            }

            function onPinchMove(event) {
                if (event.touches.length === 2) {
                    var distance = getDistance(event.touches);
                    var scale = initialScale * (distance / initialDistance);

                    var newFOV = 80 / scale;
                    cameraEl.setAttribute('fov', newFOV);
                }
            }

            function onPinchEnd(event) {
                if (event.touches.length < 2) {
                    document.removeEventListener('touchmove', onPinchMove);
                    document.removeEventListener('touchend', onPinchEnd);

                    initialDistance = null;
                }
            }

            document.addEventListener('touchstart', onPinchStart);
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var scene = document.querySelector('a-scene');


            document.querySelectorAll('a-image').forEach(function (image) {
                image.addEventListener('click', function () {
                    // Redirect the user when an image is clicked
                    window.location.href = 'https://www.izdeniz.com.tr/';
                });
            });

            // image.addEventListener('mouseenter', function () {
            //     image.setAttribute('scale', '5.5 5.5 5.5');  
            // });
            // image.addEventListener('mouseleave', function () {
            //     image.setAttribute('scale', '5 5 5');  
            // });


            if (scene) {
                scene.addEventListener('click', function () {
                    // Select all entities with animation
                    var animatedEntities = document.querySelectorAll('[animation]');

                    animatedEntities.forEach(function (entity) {
                        // Check if the animation is running and pause it
                        if (entity.components.animation && entity.components.animation.isPlaying) {
                            entity.components.animation.pause();
                        } else {
                            // If the animation is paused, this resumes it
                            entity.components.animation.play();
                        }
                    });
                });
            }
            function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
                var R = 6371;
                var dLat = deg2rad(lat2 - lat1);
                var dLon = deg2rad(lon2 - lon1);
                var a =
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                var d = R * c;
                return d * 1000;
            }

            function deg2rad(deg) {
                return deg * (Math.PI / 180);
            }

            function updateDistances() {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var userLat = position.coords.latitude;
                    var userLon = position.coords.longitude;

                    document.querySelectorAll('[gps-entity-place]').forEach(function (entity) {
                        var placeLat = entity.getAttribute('gps-entity-place').latitude;
                        var placeLon = entity.getAttribute('gps-entity-place').longitude;
                        var distance = getDistanceFromLatLonInKm(userLat, userLon, placeLat, placeLon).toFixed(2);

                        var entityId = entity.getAttribute('id') + "-distance";
                        var distanceEntity = document.getElementById(entityId);
                        if (distanceEntity) {
                            distanceEntity.setAttribute('value', ` ${distance} metre`);
                            // distanceEntity.setAttribute('value', `Mesafe: ${distance} metre`);
                        }

                        var baseScale = 5;
                        var scaleFactor = distance / 5;
                        var newScale = baseScale + scaleFactor;
                        newScale = Math.max(baseScale, newScale);

                        entity.setAttribute('scale', `${newScale} ${newScale} ${newScale}`);

                        // var baseHeight = 2; // 
                        // var heightAdjustmentFactor = 0.1; 
                        // var newHeight = baseHeight + (distance * heightAdjustmentFactor);
                        // entity.setAttribute('scale', `${newScale} ${newScale} ${newScale}`);
                        // entity.setAttribute('position', `0 ${newHeight} 0`); 
                    });
                }, function (err) {
                    console.warn('ERROR(' + err.code + '): ' + err.message);
                }, {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                });
            }

            setInterval(updateDistances, 1000);
        });
    </script>
</body>

</html>
